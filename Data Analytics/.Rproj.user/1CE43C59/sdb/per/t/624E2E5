{
    "collab_server" : "",
    "contents" : "library(data.table)\nlibrary(Hmisc)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(VIM)\nlibrary(reshape2)\nlibrary(ggplot2)\nlibrary(ggthemes)\nlibrary(caret)\npath.wd <- getwd()\npath.input <- file.path(path.wd,\"Input\")\npath.output <- file.path(path.wd,\"Output\")\nar.rate <- fread(file.path(path.input,\"AR_table_input.csv\"))\nar.rate <- fread(file.path(path.output,\"ra_rate_lm.csv\"))\nar.rate <- data.frame(ar.rate, ar_avg_2 = ar.rate$ar_avg*2)\nlm.big <- lm(formula = Rate~ar_volume_cum+cr_volume_cum+ar_avg_2+Ascore+cr_avg_display+Tomatometer,ar.rate)\nar.rate <- data.frame(ar.rate, rate_2 = ar.rate$Rate*2)\nar.rate <- data.frame(ar.rate, Ascore_10 = ar.rate$Ascore*10)\nar.rate <- as.data.table(ar.rate)\nar.rate[,Tomatometer_10:=Tomatometer*10]\nlm.big2 <- lm(formula = rate_2~ar_volume_cum+cr_volume_cum+ar_avg_2+Ascore_10+cr_avg_display+Tomatometer_10,ar.rate)\nsummary(lm.big2)\nlm.3 <- lm(formula = rate_2~ar_volume_cum+cr_volume_cum+Ascore_10+Tomatometer_10,ar.rate)\nlm.3_3 <- lm(formula = rate_2~ar_volume_cum+cr_volume_cum+ar_avg_2+cr_avg,ar.rate)\nsummary(lm.3_3)\ncorelation <- cor(ar.rate)\nar.rate[,ar_volume_cum_std := scale(ar_volume_cum)]\nar.rate[,cr_volume_cum_std := scale(cr_volume_cum)]\nar.rate[,ar_avg_std := scale(ar_avg)]\nar.rate[,cr_avg_std := scale(cr_avg_display)]\nar.rate[,Ascore_std := scale(Ascore)]\nar.rate[,Tomatometer_std := scale(Tomatometer)]\nar.rate[,Rate_std := scale(Rate)]\nlm.4 <- lm(formula = Rate_std~ar_volume_cum_std+cr_volume_cum_std+Ascore_std+Tomatometer_std,ar.rate)\nlm.4_4 <- lm(formula = Rate_std~ar_volume_cum_std+cr_volume_cum_std+Ascore_std+Tomatometer_std+SR,ar.rate)\nsummary(lm.4_4)\nwrite.csv(ar.rate,file.path(path.output,\"ra_rate_lm.csv\"),row.names = F)\ncorelation <- cor(ar.rate[,-(1:21)])\nsummary(lm.4)\nlm.5 <- lm(formula = Rate_std~ar_volume_cum_std+cr_volume_cum_std+ar_avg_std+cr_avg_std,ar.rate)\nsummary(lm.5)\nlm.5_5 <- lm(formula = Rate_std~ar_volume_cum_std+cr_volume_cum_std+ar_avg_std+cr_avg_std+SR,ar.rate)\nsummary(lm.5_5)\nrm(lm.3,lm.3_3,lm.4,lm.4_4,lm.5,lm.5_5)\n\n\nar.rate.sr <- subset(ar.rate, ar.rate$SR==1)\nar.rate.nsr <- subset(ar.rate,ar.rate$SR==0)\nqplot(ar.rate$SR)\nlm.6 <- lm(formula = rate_2~ar_volume_cum+cr_volume_cum+Ascore+Tomatometer,ar.rate.sr)\nlm.7 <- lm(formula = Rate_std~ar_volume_cum_std+cr_volume_cum_std+Ascore_std+Tomatometer_std,ar.rate.sr)\nlm.8 <- lm(formula = rate_2~ar_volume_cum+cr_volume_cum+ar_avg+cr_avg,ar.rate.sr)\nlm.9 <- lm(formula = Rate_std~ar_volume_cum_std+cr_volume_cum_std+ar_avg_std+cr_avg_std,ar.rate.sr)\n\nlm.10 <- lm(formula = rate_2~ar_volume_cum+cr_volume_cum+Ascore+Tomatometer,ar.rate.nsr)\n\nlm.11 <- lm(formula = Rate_std~ar_volume_cum_std+cr_volume_cum_std+Ascore_std+Tomatometer_std,ar.rate.nsr)\nlm.12 <- lm(formula = rate_2~ar_volume_cum+cr_volume_cum+ar_avg+cr_avg,ar.rate.nsr)\nlm.13 <- lm(formula = Rate_std~ar_volume_cum_std+cr_volume_cum_std+ar_avg_std+cr_avg_std,ar.rate.nsr)\n\nsummary(lm.11)\nwrite.csv(corelation,file.path(path.output,\"corelation.csv\"))\nrm(lm.big2,lm.3,lm.4,lm.5,lm.big)\n# frequency\nar.personal.sub <- as.data.table(ar.personal.sub)\nar.personal.sub[, Frequent := 0]\nar.personal.sub$Frequent <- as.numeric(ar.personal.sub$Frequent)\nar.personal.sub[order(-ar.personal.sub$pr_num_of_rate),][1:1000][[\"Frequent\"]] <- 1\nar.personal.sub$Frequent <- as.factor(ar.personal.sub$Frequent)\ndescribe(ar.personal.sub$Frequent)\nqplot(ar.personal.sub$Frequent)\nqplot(ar.personal.sub$pr_SR,ar.personal.sub$Frequent)\nmarginplot(ar.personal.sub[,c(\"pr_SR\",\"Frequent\")],main = \"pr_SR vs. Frequent\")\ndim(ar.personal.sub[ar.personal.sub$Frequent==1&ar.personal.sub$pr_SR==1,])[1]\n#add to ar.rate.table\nar.personal.frequent <- data.frame(UID = ar.personal.sub$UID, prFrequent = ar.personal.sub$Frequent)\nwrite.csv(ar.personal.sub, file.path(path.output,\"audience_userinfo_short_frequent.csv\"),row.names = F)\nar.rate <- left_join(ar.rate, ar.personal.frequent, by = \"UID\")\nsum(complete.cases(ar.rate))\nsum(duplicated(ar.personal.frequent$UID))\nar.rate.lm <- fread(file.path(path.output,\"ra_rate_lm.csv\"))\nar.personal.sub <- unique(ar.personal.sub, by = \"UID\")\nar.personal.frequent <- data.frame(UID = ar.personal.sub$UID, prFrequent = ar.personal.sub$Frequent)\n\nrm(ar.rate)\nar.rate <- left_join(ar.rate.lm, ar.personal.frequent, by = \"UID\")\ndescribe(ar.rate$prFrequent)\ndescribe(ar.rate.lm$Rate_std)\nar.rate[!complete.cases(ar.rate),][[\"UID\"]]\nar.rate.cleanfreq <- ar.rate[complete.cases(ar.rate),]\nrm(ar.rate.lm)\nrm(ar.personal.frequent)\nwrite.csv(ar.rate.cleanfreq,file.path(path.output,\"ra_rate_lm_addfreq.csv\"),row.names = F)\n\n\n\ndescribe(ar.rate.cleanfreq$Ascore)\n\n# lm\n#overall\nar.rate.cleanfreq <- fread(file.path(path.output,\"ra_rate_lm_addfreq.csv\"))\nlm.5 <- lm(formula = Rate_std~ar_volume_cum_std+cr_volume_cum_std+ar_avg_std+cr_avg_std+prFrequent,ar.rate.cleanfreq)\nsummary(lm.5)\nlm.5_5 <- lm(formula = Rate_std~ar_volume_cum_std+cr_volume_cum_std+Ascore_std+Tomatometer_std+prFrequent,ar.rate.cleanfreq)\nsummary(lm.5_5)\n#devide\nar.rate.freq <- subset(ar.rate.cleanfreq, ar.rate.cleanfreq$prFrequent==1)\nar.rate.nfreq <- subset(ar.rate.cleanfreq,ar.rate.cleanfreq$prFrequent==0)\nqplot(ar.rate$SR)\nlm.6 <- lm(formula = rate_2~ar_volume_cum+cr_volume_cum+Ascore+Tomatometer,ar.rate.freq)\nlm.7 <- lm(formula = Rate_std~ar_volume_cum_std+cr_volume_cum_std+Ascore_std+Tomatometer_std,ar.rate.freq)\nlm.8 <- lm(formula = rate_2~ar_volume_cum+cr_volume_cum+ar_avg+cr_avg,ar.rate.freq)\nlm.9 <- lm(formula = Rate_std~ar_volume_cum_std+cr_volume_cum_std+ar_avg_std+cr_avg_std,ar.rate.freq)\n\nlm.10 <- lm(formula = rate_2~ar_volume_cum+cr_volume_cum+Ascore+Tomatometer,ar.rate.nfreq)\n\nlm.11 <- lm(formula = Rate_std~ar_volume_cum_std+cr_volume_cum_std+Ascore_std+Tomatometer_std,ar.rate.nfreq)\nlm.12 <- lm(formula = rate_2~ar_volume_cum+cr_volume_cum+ar_avg+cr_avg,ar.rate.nfreq)\nlm.13 <- lm(formula = Rate_std~ar_volume_cum_std+cr_volume_cum_std+ar_avg_std+cr_avg_std,ar.rate.nfreq)\nsummary(lm.13)\nrm(lm.6, lm.7, lm.8, lm.9, lm.10, lm.11, lm.12, lm.13)\n\n#aggre ar cr\nar.rate.cleanfreq <- as.data.table(ar.rate.cleanfreq)\nar.rate.cleanfreq[, Ascore_round := round(Ascore*100)/100]\nar.rate.cleanfreq[, Tomatometer_round := round(Tomatometer*100)/100]\ndescribe(ar.rate.cleanfreq$Ascore_round)\nqplot(ar.rate.cleanfreq$Ascore_round)\nar.rate.cleanfreq$Ascore_round <- as.factor(ar.rate.cleanfreq$Ascore_round)\nar.rate.cleanfreq$Tomatometer_round <- as.factor(ar.rate.cleanfreq$Tomatometer_round)\nqplot(ar.rate.cleanfreq$Tomatometer_round)\nattach(ar.rate.cleanfreq)\nAscore.aggr <- aggregate(Rate~Ascore_round, FUN = mean)\nTomatometer.aggr <- aggregate(Rate~Tomatometer_round, FUN = mean)\nqplot(Ascore.aggr$Ascore_round,Ascore.aggr$Rate)\ndetach(ar.rate.cleanfreq)\nlm.as <- lm(Rate~Ascore_round,Ascore.aggr)\nlm.tm <- lm(Rate~Tomatometer_round,Tomatometer.aggr)\n\n\n\neqn.as <- as.character(as.expression(\n  substitute(italic(y) == a + b * italic(x) * \",\" ~~ italic(r)^2 ~ \"=\" ~ r2,\n             list(a = format(coef(lm.as)[1], digits=3),\n                  b = format(coef(lm.as)[2], digits=3),\n                  r2 = format(summary(lm.as)$r.squared, digits=2)\n             ))))\n\neqn.tm <- as.character(as.expression(\n  substitute(italic(y) == a + b * italic(x) * \",\" ~~ italic(r)^2 ~ \"=\" ~ r2,\n             list(a = format(coef(lm.tm)[1], digits=3),\n                  b = format(coef(lm.tm)[2], digits=3),\n                  r2 = format(summary(lm.tm)$r.squared, digits=2)\n             ))))\n\n\nplot = ggplot(Ascore.aggr, aes(x = Ascore_round, y = Rate))\nplot = plot + geom_point(alpha = 1,size = 1.5, col = \"grey60\") +\n  ggtitle(\"Ascore vs. 平均评分\", element_text(size=30)) +\n  labs(x = \"Ascore\", y = \"平均评分\") + \n  # geom_line(linetype = \"dashed\") +\n  stat_smooth(method = lm, col = \"red\")+\n  annotate(\"text\", label=eqn.as, parse=TRUE, x=Inf, y=-Inf, hjust=1.1, vjust=-.5)+\n  theme_stata()+\n  theme(plot.title = element_text(size = 17), axis.text=element_text(size=14),axis.title.x = element_text(size=15, vjust = -2),axis.title.y = element_text(size=15,vjust = -5))\n# theme_solarized_2()\n# theme_wsj()\nplot\n\nplot = ggplot(Tomatometer.aggr, aes(x = Tomatometer_round, y = Rate))\nplot = plot + geom_point(alpha = 1,size = 1.5, col = \"grey60\") +\n  ggtitle(\"Tomatometer vs. 平均评分\", element_text(size=30)) +\n  labs(x = \"Tomatometer\", y = \"平均评分\") + \n  # geom_line(linetype = \"dashed\") +\n  stat_smooth(method = lm, col = \"red\")+\n  annotate(\"text\", label=eqn.tm, parse=TRUE, x=Inf, y=-Inf, hjust=1.1, vjust=-.5)+\n  theme_stata()+\n  theme(plot.title = element_text(size = 17), axis.text=element_text(size=14),axis.title.x = element_text(size=15, vjust = -2),axis.title.y = element_text(size=15,vjust = -5))\n# theme_solarized_2()\n# theme_wsj()\nplot\n",
    "created" : 1495545617387.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "808475246",
    "id" : "624E2E5",
    "lastKnownWriteTime" : 1493835397,
    "last_content_update" : 1493835397,
    "path" : "D:/MicFile/百度云同步盘/R_Workspace/GraduateProject/DataAnalysis/arVScr_overall.R",
    "project_path" : "arVScr_overall.R",
    "properties" : {
        "source_window_id" : "",
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}